\documentclass[11pt]{article}
%\overfullrule=5pt
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}

\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\PSL}{PSL}
\newcommand{\Q}{{\mathbb Q}}
\newcommand{\Z}{{\mathbb Z}}
\newcommand{\R}{{\mathbb R}}
\newcommand{\C}{{\mathbb C}}
\newcommand{\z}{\zeta}
\newcommand{\G}{\Gamma}
\newcommand{\new}{\text{new}}

\def\kbd#1{{\tt #1}}

\begin{document}
\pagestyle{plain}

\title{Tutorial for Modular Forms in Pari/GP}
\author{Henri Cohen}

\maketitle

\smallskip

\section{Introduction}

Three packages are available to work with modular forms and related functions
in \kbd{Pari/GP}. The first one is the $L$-function package, which has been
available since 2.9.0 (2015), and computes with general motivic
$L$-functions, and in particular with $L$-functions attached to Dirichlet
characters, Hecke characters, Artin representations, and modular forms. The
name of most functions in this package begins with \kbd{lfun}, such as
\kbd{lfuninit}.

The second is the modular symbol package, whose primary aim
is not so much to compute modular form spaces and modular forms, but to
compute $p$-adic $L$-functions attached to modular forms. The name of most
functions in this package begins with \kbd{ms}, such as \kbd{msinit}.

The third package is the modular forms package, whose aim is to compute in
the standard spaces $M_k(\G_0(N),\chi)$ with $k$ integral, both with modular
form \emph{spaces} and individual modular forms. The name of most functions in
this package begins with \kbd{mf}, such as \kbd{mfinit}. The goal of the
present manual is to describe this package in view of a new user's guide, so
will be more a tutorial than an actual reference guide, although we do include
such a guide at the end.

\medskip

We can work on five subspaces of $M_k(\G_0(N),\chi)$, through a
corresponding \emph{space flag} in the commands: the cuspidal \emph{new
space} $S_k^{\new}(\G_0(N),\chi)$ (flag = 0, which can be omitted since it is
considered the default), the full cuspidal space $S_k(\G_0(N),\chi)$ (flag =
1), the old space $S_k^{\text{old}}(\G_0(N),\chi)$ (flag = 2, probably of
little use), the full space including the Eisenstein part $M_k(\G_0(N),\chi)$
(flag = 3), and finally the space generated by all Eisenstein series ${\cal
E}_k(\G_0(N),\chi)$ (flag = 4). Note that although it can be defined, we have
not included the space $M_k^{\new}$, nor the ``certain space'' of
Zagier--Skoruppa.

Note in particular that the package includes the computation of modular
forms of weight $k=1$.

\medskip

The modular forms themselves are represented in a special internal format
which the user need not worry about and which basically is a recipe to
compute successive Fourier coefficients at infinity : if $F$ is a GP modular
form, \kbd{mfcoefs}$(F, 10)$ will give you the Fourier coefficients at infinity
from $a(0)$ to $a(10)$ of the modular form corresponding to $F$. Many
operations are available on such objects (see below), but the most important
thing the user needs to know is that the number of Fourier coefficients need
not be specified in advance: the command \kbd{mfcoefs}$(F,n)$ is valid for
any integer $n$. We will of course explain the details of this below.

\section{Creation of Modular Forms}

In \kbd{Pari/GP} modular forms can be created in three different ways:

\begin{itemize}\item As \emph{basic modular forms}, i.e., forms attached (or
  not) to different mathematical objects, and which are of so frequent use
  that we have implemented them so that the user has them at his disposal.
  Examples: \kbd{mfDelta} (Ramanujan's delta), \kbd{mfEk}
  (Eisenstein series of weight $k$ on the full modular group; of course
  we also have completely general Eisenstein series), \kbd{mfetaquo}
  (eta quotients), \kbd{mffromell} (modular form attached to an elliptic
  curve over $\Q$), more generally \kbd{mfcreate} (the user gives the
  recipe for the Fourier coefficients), \kbd{mffromqf} (modular form attached
  to a lattice).
\item From existing forms by applying \emph{operations}.
  Examples: multiplication/division, linear combination,
  derivation and integration, Serre derivative, RC-brackets, Hecke and
  Atkin--Lehner operations, expansion and diamond operators, etc...
\item Through the creation of the modular form \emph{spaces}:
  typically, if only \kbd{mf=mfinit} is applied, then a (essentially random)
  basis of forms is obtained by the command \kbd{mfbasis(mf)}. If
  \kbd{mf=mfsplit(mfinit)} (or simply \kbd{mf=mfsplit}) has been applied,
  then \kbd{mfeigenbasis(mf)} produces the canonical basis of eigenforms
  (in some order).\end{itemize}

\section{A First Session: working with Leaves}

This is now a tutorial session. We will see sample commands as we go along.

\begin{verbatim}
? D = mfDelta(); V = mfcoefs(D, 8)
% = [0, 1, -24, 252, -1472, 4830, -6048, -16744, 84480]
\end{verbatim}

\kbd{V=mfcoefs(D,n)} simply gives the vector of Fourier coefficients (at
infinity) $[a(0),a(1),....,a(n)]$ (note that there are $n+1$). This is the
compact way of looking, but if you really want power series you can
use \kbd{Ser(V,q)} (convert a vector into a power series).

\begin{verbatim}
% = q - 24*q^2 + 252*q^3 - 1472*q^4 + 4830*q^5 - 6048*q^6\
      - 16744*q^7 + 84480*q^8 + O(q^9)
\end{verbatim}

Similarly

\begin{verbatim}
? E4 = mfEk(4); E6 = mfEk(6); apply(x->mfcoefs(x,3),[E4,E6])
% = [[1, 240, 2160, 6720], [1, -504, -16632, -122976]]
? E43 = mfpow(E4, 3); E62 = mfpow(E6, 2);
? DP = mflinear([E43, E62], [1, -1]/1728);
? mfcoefs(DP, 6)
% = [0, 1, -24, 252, -1472, 4830, -6048]
? mfisequal(D, DP)
% = 1
\end{verbatim}

Self-explanatory. Note that there is a command \kbd{mfcoef(F, n)} (without
the final ``s'') which simply outputs the coefficient $a(n)$, which may be
useful in certain circumstances. A final example of the same type:

\begin{verbatim}
? F = mfetaquo([1,2;11,2]); mfcoefs(F,10)
% = [0, 1, -2, -1, 2, 1, 2, -2, 0, -2, -2]
? G = mffromell(ellinit("11a1"))[2];
? mfisequal(F, G)
% = 1
\end{verbatim}

This requires a little explanation: \kbd{mfetaquo} takes as argument
a matrix representing an \emph{eta quotient}, here
$\eta(1\tau)^2\eta(11\tau)^2$. Since there is no way to represent fractional
powers in \kbd{Pari/GP}, we have chosen to give only the integer part
of the correct exponent when it is nonnegative. In the present case it
is an integer, so the result is correct, but in other cases it could be
fractional. Note that the second component of the \kbd{mffromell} output is
the modular form associated to the elliptic curve by modularity.

\section{A Second Session: Modular Form Spaces}

In the first session, we have seen a few preinstalled modular forms (that
we can call \emph{leaves}), and a number of operations on them. All reasonable
operations have been implemented (if some are missing, please tell us). We are
now going to work with \emph{spaces} of modular forms.

\begin{verbatim}
? mf = mfinit([1,12]); L = mfbasis(mf); #L
% = 1
? mfdim(mf)
% = 1
\end{verbatim}

This creates the new space of cuspidal forms of level $1$ and weight $12$
(of course here this is equal to the cuspidal space). This space is created
thanks to an almost random basis that one can obtain using \kbd{mfbasis},
and we see either by asking for the number of elements of \kbd{L} or by
using the command \kbd{mfdim}, that it has dimension $1$, not surprising.
We can see it better by writing:

\begin{verbatim}
? mfcoefs(L[1],6)
% = [0, 1, -24, 252, -1472, 4830, -6048]
\end{verbatim}

Let us now work in the full space $M_{12}(\G)$: for this we use the flag 3:

\begin{verbatim}
? mf = mfinit([1,12],3); L = mfbasis(mf); #L
% = 2
? mfcoefs(L[1],6)
% = [691/65520, 1, 2049, 177148, 4196353, 48828126, 362976252]
? mfcoefs(L[2],6)
% = [0, 1, -24, 252, -1472, 4830, -6048]
\end{verbatim}

Note two things: first, the Eisenstein series are given before the cusp forms
(this may change, but for now this is the case), and second, the Eisenstein
series is normalized so that it is the coefficient $a(1)$ which is equal to
$1$, and not $a(0)$. In particular, here at least, it is a normalized
Hecke eigenform.

Let us now look at higher dimensional cases:

\begin{verbatim}
? mf = mfinit([35,2]); L = mfbasis(mf); #L
% = 3
? for (i = 1, 3, print(mfcoefs(L[i], 10)))
[0, 3, -1, 0, 3, 1, -8, -1, -9, 1, -1]
[0, -1, 9, -8, -11, -1, 4, 1, 13, 7, 9]
[0, 0, -8, 10, 4, -2, 4, 2, -4, -12, -8]
\end{verbatim}

These are essentially random cusp forms. Usually, you want the eigenforms:
this is obtained by the function \kbd{mfsplit} (note in passing that
\kbd{mfsplit(mf)} simply adds some components to \kbd{mf}, so one can
give it the same name without losing any information):

\begin{verbatim}
? mf = mfsplit(mf); mffields(mf)
% = [y, y^2 - y - 4]
? L = mfeigenbasis(mf); #L
% = 2
? mfcoefs(L[1],10)
% = [0, 1, 0, 1, -2, -1, 0, 1, 0, -2, 0]
? mfcoefs(L[2],4)
% = [Mod(0, y^2 - y - 4), Mod(1, y^2 - y - 4),\
     Mod(-y, y^2 - y - 4),Mod(y - 1, y^2 - y - 4),\
     Mod(y + 2, y^2 - y - 4)]
? lift(mfcoefs(L[2],10))
% = [0, 1, -y, y - 1, y + 2, 1, -4, -1, -y - 4, -y + 2, -y]
\end{verbatim}

The command \kbd{mffields} gives the polynomials in the variable $y$ defining
the number field extensions on which
the eigenforms are defined. Here, one of the fields is $\Q$, the other is
$\Q(\sqrt{17})$. To obtain the eigenforms, we use \kbd{mfeigenbasis}, and
there are only two and not three, since the one defined on $\Q(\sqrt{17})$
goes together with its conjugate. Asking directly \kbd{mfcoefs(L[2],4)} gives
the coefficients as \kbd{polmods}, not easy to read, so it is usually
preferable to \emph{lift} them, giving the last command, where in the output
we must of course remember that $y$ stands for \emph{one} of the two roots
of $y^2-y-4=0$, i.e., $(1\pm\sqrt{17})/2$.

In fact, for quite a number of numerical computations, we really need the
coefficients of the eigenform embedded in $\C$, and not just as abstract
algebraic numbers (in our case of trivial character, they will be in $\R$).
This is done with the function \kbd{mfembed}:

\begin{verbatim}
? F=mfembed(L[2]);for(i=1,2,print(mfcoefs(F[i],5)))
[0, 1, 1.5615528128088302749107049279870385126,\
      -2.5615528128088302749107049279870385126,\
       0.43844718719116972508929507201296148743, 1]
[0, 1, -2.5615528128088302749107049279870385126,\
        1.5615528128088302749107049279870385126,\
        4.5615528128088302749107049279870385126, 1]
\end{verbatim}

The first eigenform is \emph{rational}, hence by the modularity theorem there
exists up to isogeny a unique elliptic curve to which it corresponds.
We check this by writing

\begin{verbatim}
? [mf,F,co] = mffromell(ellinit("35a1")); mfcoefs(F, 10)
% = [0, 1, 0, 1, -2, -1, 0, 1, 0, -2, 0]
? mfisequal(F, L[1])
% = 1
\end{verbatim}

For a more typical example (still with no character):

\begin{verbatim}
? apply(x->mfdim([96, 2], x), [0..4])
% = [2, 9, 7, 24, 15]
\end{verbatim}

This gives us the dimensions of the new space, the cuspidal space,
the old space, the whole space of modular forms, and the space of Eisenstein
series.

Just for fun, we write:

\begin{verbatim}
? mf = mfinit([96,2],3); L = mfbasis(mf);
? for (i = 12, 15, print(mfcoefs(L[i], 15)))
[23/24, 1, 3, 4, 7, 6, 12, 8, 15, 13, 18, 12, 28, 14, 24, 24]
[31/24, 1, 3, 4, 7, 6, 12, 8, 15, 13, 18, 12, 28, 14, 24, 24]
[47/24, 1, 3, 4, 7, 6, 12, 8, 15, 13, 18, 12, 28, 14, 24, 24]
[95/24, 1, 3, 4, 7, 6, 12, 8, 15, 13, 18, 12, 28, 14, 24, 24]
\end{verbatim}

Apparently, these four Eisenstein series differ only by their constant
term, which is of course not possible. Indeed:

\begin{verbatim}
? F = mflinear([L[14],L[12]],[1,-1]); mfcoefs(F, 50)
% = [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\
     0, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 0, 0]
? G = mfhecke(F, 24); mfcoefs(G, 12)
% = [1, 24, 24, 96, 24, 144, 96, 192, 24, 312, 144, 288, 96]
? mftobasis(mf, G)
% = [0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\
     0, 0, 0, 0, 0, 0]~
? 24*mfcoefs(L[5], 12)
% = [1, 24, 24, 96, 24, 144, 96, 192, 24, 312, 144, 288, 96]
\end{verbatim}

The first command shows that the Eisenstein series differ on their $n$-th
Fourier coefficient for $n=0$, $24$, and $48$, and the second command applies
the Hecke operator $T_{24}$ (sometimes denoted $U_{24}$) to the difference,
whose effect is to replace $a(n)$ by $a(24n)$, giving the much more
compact output of $G$. The last commands show that $G$ is equal to
$24$ times the fifth Eisenstein series \kbd{L[5]}.

\begin{verbatim}
? mf=mfsplit([96,2]); mffields(mf)
% = [y, y]
? L = mfeigenbasis(mf); for(i=1, 2, print(mfcoefs(L[i], 16)))
[0, 1, 0, 1, 0, 2, 0, -4, 0, 1, 0, 4, 0, -2, 0, 2, 0]
[0, 1, 0, -1, 0, 2, 0, 4, 0, 1, 0, -4, 0, -2, 0, -2, 0]
? Fa = mffromell(ellinit("96a1"))[2]; mfcoefs(Fa, 16)
% = [0, 1, 0, 1, 0, 2, 0, -4, 0, 1, 0, 4, 0, -2, 0, 2, 0]
? Fb = mffromell(ellinit("96b1"))[2]; mfcoefs(Fb, 16)
% = [0, 1, 0, -1, 0, 2, 0, 4, 0, 1, 0, -4, 0, -2, 0, -2, 0]
\end{verbatim}
Note that \kbd{mfsplit([96,2])} is a shorthand for
\kbd{mfsplit(mfinit([96,2]))}.

The \kbd{mffromell} function returns a triple \kbd{[mf,F,C]},
where \kbd{mf} is the modular form cuspidal space to which \kbd{F} belongs,
\kbd{F} is the rational eigenform corresponding to the elliptic curve by
modularity, and \kbd{C} is the vector of coefficients of \kbd{F} on the
basis in \kbd{mf}, which we recall is not always a basis of eigenforms
(otherwise \kbd{F} would belong to this basis).

Note also that clearly \kbd{Fa} and \kbd{Fb} are twists of one another:

\begin{verbatim}
? mfisequal(mftwist(Fa, -4), Fb)
% = 1
\end{verbatim}

\section{Interlude: Dirichlet characters}

There are many ways to represent multiplicative characters on $(\Z/N\Z)^*$ in
\kbd{Pari/Gp}, we will list them by increasing order of sophistication,
restricting to characters with complex values:

\begin{itemize}

\item A quadratic character $(D/.)$ (Kronecker symbol) is described by
the integer $D$. For instance $1$ is the trivial character.

\item There is a (non-canonical but fixed) bijection between $(\Z/N\Z)^\times$
and its character group, via \emph{Conrey labels}. So \kbd{Mod}$(a,N)$
represents a character whenever $a$ is coprime to $N$. This makes it easy
to loop on all characters without worrying too much about which is which.
In this labelling, \kbd{Mod(1,N)} is the trivial character.

\item The finite abelian group $G = (\Z/N\Z)^*$ is written
$$G = \bigoplus_{i\leq n}\; (\Z/d_i\Z) \cdot g_i,$$
with $d_n \mid \dots \mid d_2 \mid d_1$ (SNF condition), all $d_i > 0$, and
$\prod_i d_i = \phi(N)$. The SNF condition makes the $d_i$ unique, but the
generators $g_i$, of respective order $d_i$, are definitely not unique. The
$\oplus$ notation means that all elements of $G$ can be written uniquely as
$\prod_i g_i^{n_i}$ where $n_i \in \Z/d_i\Z$. The $g_i$ are the so-called
\emph{SNF generators} of $G$. The command \kbd{znstar}$(N)$ outputs the SNF
structure (group order, $d_i$ and  $g_i$), but $G = \kbd{znstar}(N, 1)$ is
needed to initialize a group we can work with: most importantly we can now
solve discrete logarithm problems and decompose elements on the $g_i$.

A character on the abelian group $\oplus (\Z/d_j\Z) g_j$ is given by a row
vector $\chi = [a_1,\ldots,a_n]$ of integers $0\leq a_i  < d_i$ such that
$\chi(g_j) = e(a_j / d_j)$ for all $j$, with the standard notation $e(x) :=
\exp(2i\pi x)$. In other words, $\chi(\prod g_j^{n_j}) = e(\sum a_j n_j /
d_j)$. In this encoding $[0,\dots,0]$ is the trivial character. Of course
a character $\chi$ must always be given as a \emph{pair} $[G,\chi]$,
since $\chi$ is meaningless without knowledge of the $(g_i)$ or the $(d_i)$.
\end{itemize}

The command \kbd{znchar}$(S)$ converts a datum describing a character to the
third form $[G,\chi]$. The command \kbd{znchartokronecker} converts a
character of order $\leq 2$ to the first form $(D/.)$, and functions such
as \kbd{zncharconductor}, \kbd{znchartoprimitive}, and \kbd{zncharinduce}
allow to restrict or extend characters between different $(\Z/M\Z)^*$.

Note the important fact that it is necessary to give the two arguments $G$ and
$\chi$ separately to these functions, for instance \kbd{zncharconductor(G,chi)}
(and not \kbd{zncharconductor([G,chi])}).

Functions such as \kbd{charmul}, \kbd{chardiv}, \kbd{charpow},
\kbd{charorder} or \kbd{chareval} apply to more general abelian characters
than characters on $(\Z/N\Z)^\times$, whence the prefix \kbd{char} instead of
\kbd{znchar}.

\section{A Third Session: Nontrivial Characters}

Recall that a nontrivial character can be represented either by a discriminant
$D$ not necessarily fundamental, the character being the Legendre--Kronecker
symbol $(D/n)$, or by its \emph{Conrey label} in $(\Z/N\Z)^\times$, such as
\kbd{Mod(161,633)}.

Defining modular form spaces with character is as simple as without:
instead of, say, \kbd{mf=mfinit([35,2])}, one can write
\kbd{mf=mfinit([35,2,5])}. Thus:

\begin{verbatim}
? mf = mfsplit([35,2,5]); mffields(mf)
% = [y^2 + 1]
? F = mfeigenbasis(mf)[1]; lift(mfcoefs(F, 10))
% = [0, 1, 2*y, -y, -2, -y - 2, 2, -y, 0, 2, -4*y + 2]
\end{verbatim}
where in the last output $y$ is equal to one of the two roots of $y^2+1=0$,
i.e., $\pm i$.

Working with nontrivial characters allows us in particular to work with odd
weights, and in particular in weight $1$:

\begin{verbatim}
? mf = mfinit([23,1,-23]); mfdim(mf)
% = 1
? F = mfbasis(mf)[1]; mfcoefs(F, 16)
% = [0, 1, -1, -1, 0, 0, 1, 0, 1, 0, 0, 0, 0, -1, 0, 0, -1]
? mfgaloistype(mf,F)
% = 6
\end{verbatim}

The last output means that the image in $\PSL_2(\C)$ of the projective
representation associated to $F$ is of type $D_6$. Note that an ''exotic''
representation is given by a negative number, opposite of the cardinality
of the projective image.

Since this form is of dihedral type, it can be obtained via theta functions.
Indeed:

\begin{verbatim}
? F1 = mffromqf([2,1;1,12])[2]; V1 = mfcoefs(F1, 16)
% = [1, 2, 0, 0, 2, 0, 4, 0, 4, 2, 0, 0, 4, 0, 0, 0, 2]
? F2 = mffromqf([4,1;1,6])[2]; V2 = mfcoefs(F2, 16)
% = [1, 0, 2, 2, 2, 0, 2, 0, 2, 2, 0, 0, 4, 2, 0, 0, 4]
? (V1 - V2)/2
% = [0, 1, -1, -1, 0, 0, 1, 0, 1, 0, 0, 0, 0, -1, 0, 0, -1]
? mfisequal(F, mflinear([F1, F2], [1, -1]/2))
% = 1
\end{verbatim}

Here we were lucky in that we ``knew'' that the correct character was
$(-23/n)$. But what if we did not know this ? The first observation is
that modular form spaces corresponding to Galois conjugate characters
are isomorphic ($\chi$ is Galois conjugate to $\chi'$ if $\chi'=\chi^m$
for some $m$ coprime to the order of $\chi$). Thus, it is sufficient
to find a representative of each equivalence class, and this is given by
the \kbd{GP} commands \kbd{G=znstar(N,1); znchargalois(G)}, where $N$ is the
level of the desired character (note that $N$ will not necessarily be
the conductor of the characters). This exactly outputs a list of representative
of each equivalence class (do not for now try to understand the details of
this command, nor the fact that \kbd{znchargalois} and \kbd{znstar} have
optional parameters). However, this is not quite yet what we want.
Although only for efficiency, we want characters with the same parity
as the weight, otherwise the corresponding modular form spaces will be $0$.
This is achieved by the \kbd{GP} command \kbd{zncharisodd(G,chi)} which
does what you think it does. Note that a \kbd{Pari/GP} character is always
a \emph{pair} \kbd{[G,chi]} as above.

Let us first do this for $N=23$: we write

\begin{verbatim}
? G = znstar(23, 1);
? L = [[G,chi] | chi<-znchargalois(G), zncharisodd(G,chi)]; #L
% = 2
? apply(x->mfdim([23,1,x]), L)
% = [0, 1]
? apply(x->charorder(x[1],x[2]), L)
% = [22, 2]
\end{verbatim}

This tells us that (up to Galois conjugation) there are two possible odd
characters, one, of order $22$, giving a $0$-dimensional space, the other
being the quadratic character given above. Note two things: first, a character
is always a \emph{pair} \kbd{[G,chi]}, and since \kbd{znchargalois} only
returns the list of \kbd{chi}, we must write \kbd{[G,chi]} for the character.
For the same reason, to obtain the order of a character we must write
\kbd{charorder(chi[1], chi[2])} (or \kbd{charorder(G, chi[2])}).

When doing long explorations with all characters of a certain level, it
is preferable to use \emph{wildcards}. For instance, instead of the above
one can write:

\begin{verbatim}
? mfa = mfinit([23,1,0]); #mfa
% = 1
? mf = mfa[1]; mfdim(mf)
% = 1
? mfparams(mf)
% = [23, 1, -23]
\end{verbatim}

This does not exactly give us the same information: the third parameter $0$
in the first command asks for \emph{all} nonempty spaces of level $23$ and
weight $1$, and the program tells us that there is only one, of dimension $1$.
The last command outputs \kbd{[N,k,CHI]}, so here tells us that the
corresponding character is the Kronecker--Legendre symbol $(-23/n)$.

Using wildcards, let us explore levels in certain ranges: we write

\begin{verbatim}
wt1exp(lim1,lim2)=
{
  my(mfall,mf,chi,chiz,ord,M,res,V);
  for(N=lim1,lim2,
    mfall=mfinit([N,1,0]); /* Use wildcard, more efficient */
    for(i=1,#mfall,
      mf=mfsplit(mfall[i]);
      chi=mfparams(mf)[3]; /* nice format: D or Mod(a,N) */
      chiz=znchar(chi); /* necessary to use charorder */
      ord=charorder(chiz[1],chiz[2]);
      M=mfeigenbasis(mf);
      for(k=1,#M,
        res=mfgaloistype(mf,M[k]);
        if(res<0,print([N,chi,k,ord,-res]))
      )
    )
  );
}
\end{verbatim}

For instance, \kbd{wt1exp(1,230)} outputs in 8 seconds

\begin{verbatim}
[124, Mod(67, 124), 1, 6, 12]
[133, Mod(83, 133), 1, 6, 12]
[148, Mod(105, 148), 1, 4, 24]
[171, Mod(94, 171), 1, 6, 12]
[201, Mod(29, 201), 1, 6, 12]
[209, Mod(87, 209), 1, 6, 12]
[219, Mod(8, 219), 2, 6, 12]
[224, Mod(95, 224), 1, 6, 12]
[229, Mod(107, 229), 1, 4, 24]
[229, Mod(107, 229), 2, 4, 24]
\end{verbatim}

Thus, the smallest exotic $A_4$ form is in level $124$ with a character
of order $6$, and the smallest $S_4$ form is in level $148$ with a character
of order $4$ (note that these are not the only possible orders). Note that
in level $229$, for a certain character of order $4$ we have two (non Galois
conjugate) eigenforms of type $S_4$.

If we type \kbd{wt1exp(633,633)}, in 11 seconds we obtain
\kbd{[633, Mod(71, 633), 2, 10, 60]}, and this level is indeed the lowest
level for which there exists a type $A_5$ form, here with a character of order
$10$.

\section{A Fourth Session: Miscellaneous Commands}

This is not yet the reference manual. In approximate alphabetical order:

\begin{verbatim}
? mf=mfsplit([96,6]); mffields(mf)
% = [y, y, y, y, y, y, y^2 - 31, y^2 - 31]
? mfatkineigenvalues(mf,3)
% = [[-1], [-1], [-1], [1], [1], [1], [-1, -1], [1, 1]]
? mf=mfsplit([96,3,-3]); mffields(mf)
% = [y^4 + 8*y^2 + 9, y^4 + 4*y^2 + 1]
? mfatkineigenvalues(mf,3)
  ***   at top-level: mfatkineigenvalues(mf,3)
  ***                 ^-------------------------
  *** mfatkineigenvalues: sorry, pseudo eigenvalues
      for W_Q is not yet implemented.
? mfatkineigenvalues(mf,32)
% = [[I, -I, -I, I], [-I, I, I, -I]]
\end{verbatim}

Three things to note: first, the eigenvalues in any Galois orbit are \emph{not}
necessarily the same: in the first example they are, but in the second not:
for instance the four eigenforms corresponding to the four embeddings of
\kbd{mfeigenbasis(mf)[1]} do not have the same Atkin eigenvalue. Second, in
the present implementation it is necessary that the character be defined
modulo $N/Q$, where $N$ is the level and $Q$ the Atkin divisor; thus, for
$N=96$ and $Q=3$ we have $N/Q=32$ and since the character $(-3/n)$ is not
defined modulo $32$ we have an error message. This may change in the future.
On the other hand, for $N=96$ and $Q=32$ there is no problem.

\medskip

\begin{verbatim}
? mf = mfinit([96,2], 1); L = mfbasis(mf);
? apply(x->mfconductor(mf,x), L)
% = [24, 48, 96, 32, 96, 48, 96, 96, 96]
\end{verbatim}

Here we compute the full cuspidal space $S_2(\G_0(96))$, of dimension $9$,
and we ask which is the lowest level on which each form in the basis
is defined. This list shows that there is one form $F_1$ in level $24$
which, by applying $B(d)$ with $d=2$ and $d=4$ gives a form of level $48$
and one of level $96$. Then a form $F_2$ in level $32$, by applying $B(3)$
gives a form of level $96$, a form $F_3$ in level $48$, by applying $B(2)$
gives a form of level $96$, and finally two genuine forms of level $96$
(so that the dimension of the newspace is equal to $2$, which we can check
by typing \kbd{mfdim([96,2])}).

\medskip

\begin{verbatim}
? mf = mfsplit([35,2]); L=mfbasis(mf);
? for (i=1,#L,print(mfcoefs(L[i],15)))
[0, 3, -1, 0, 3, 1, -8, -1, -9, 1, -1, -2, 4, 10, 1, -2]
[0, -1, 9, -8, -11, -1, 4, 1, 13, 7, 9, 8, -20, 6, -9, -8]
[0, 0, -8, 10, 4, -2, 4, 2, -4, -12, -8, -12, 12, -6, 8, 8]
? for (i=1,#L,print(mfcuspexpansion(mf,L[i],1/5,15)));
[0, 1, -1, -2, 7, 3, -8, -3, -9, 5, -1, 4, 8, 0, 1, 0]
[0, -1, 9, -8, -11, -1, 4, 1, 13, 7, 9, 8, -20, 6, -9, -8]
[0, -2, -8, 8, 8, 0, 4, 0, -4, -8, -8, -6, 16, -16, 8, 10]
\end{verbatim}

The function \kbd{mfcuspexpansion(mf,F,cusp,n)} returns the first $n+1$
Fourier coefficients of $F$ at the given cusp (recall that such coefficients
are only defined up to an equivalence relation). The cusp must be
in the form $A/C$ with $C\mid N$, or $\infty$. This is a very preliminary
mplementation: the primary restriction is that it works only in squarefree
levels. Less importantly, for now the space \kbd{mf} must be the new space
$S_k^{\new}$ (and in addition must be split). This will be improved in the
future.

Note in passing the following function on cusps: \kbd{mfcusps(N)} gives
the list of all (equivalence classes of) cusps of $\G_0(N)$,
\kbd{mfcuspwidth(N,cusp)} gives the width of the cusp, and
\kbd{mfcuspisregular([N,k,CHI],cusp)} determines if the cusp is regular or
not (do not worry if you do not know these notions):

\begin{verbatim}
? C = mfcusps(108)
% = [0, 1/2, 1/3, 2/3, 1/4, 1/6, 5/6, 1/9, 2/9, 1/12,\
       5/12, 1/18, 5/18, 1/27, 1/36, 5/36, 1/54, 1/108]
? apply(x->mfcuspwidth(108,x), C)
% = [108, 27, 12, 12, 27, 3, 3, 4, 4, 3, 3, 1, 1, 4, 1, 1, 1, 1]
? NK = [108,3,-4];
? apply(x->mfcuspisregular(NK,x), C)
% = [1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1]
? [c | c<-C, !mfcuspisregular(NK,c)]
% = [1/2, 1/6, 5/6, 1/18, 5/18, 1/54]
\end{verbatim}

The first command list the $18$ cusps of $\G_0(108)$ (\kbd{mfnumcusps(108)}
gives this directly, useful if there are thousands of cusps and you do not
want them explicitly), the second command prints their widths, and the last
commands show that the cusps $1/2$, $1/6$, $5/6$, $1/18$, $5/18$, and $1/54$
are irregular in the space $M_3(\G_0(108),\chi_{-4})$, and the others are
regular.

\medskip

\begin{verbatim}
? E4 = mfEk(4); G = mfderivE2(E4); mfcoefs(G, 6)
% = [-1/3, 168, 5544, 40992, 177576, 525168, 1352736]
? mfcoefs(mfEk(6), 6)/(-3)
% = [-1/3, 168, 5544, 40992, 177576, 525168, 1352736]
? F = mfderivE2(E4, 3); (-9)*mfcoefs(F, 5)
% = [1, -264, -135432, -5196576, -69341448, -515625264]
? mfisequal(mfEk(10), mflinear([F],[-9]))
% = 1
\end{verbatim}

This tells us that the Serre derivative of $E_4$ is equal to $-E_6/3$,
and its third Serre derivative is equal to $-E_{10}/9$. Note that there
exists the simpler function \kbd{mfderiv}, but recall that (apart in weight
$0$) the derivative of a modular form is only quasi-modular.

\medskip

\begin{verbatim}
? E4 = mfEk(4); mfeval(E4,I)
% = 1.4557628922687093224624220035988692874
? 3*gamma(1/4)^8/(2*Pi)^6
% = 1.4557628922687093224624220035988692874
\end{verbatim}

We can usually evaluate a modular form on the upper half-plane. When
evaluating at a CM point such as $i$, if the form has algebraic
Fourier coefficients the result is an algebraic number times the power
of a \emph{period}, such as in the above example.

\medskip

\begin{verbatim}
? mf = mfinit([96,4]); mfdim(mf)
% = 6
? M = mfmathecke(mf, 7)
% =
[0    0   0    372    696   0]

[0    0  36      0      0 -96]

[0 27/5   0 -276/5 -276/5   0]

[1    0 -12      0      0  62]

[0    0   1      0      0 -16]

[0 -3/5   0   14/5  -16/5   0]
? P = charpoly(M)
% = x^6 - 1456*x^4 + 209664*x^2 - 2985984
? factor(P)
% =
[x - 36 1]

[x - 12 1]

[ x - 4 1]

[ x + 4 1]

[x + 12 1]

[x + 36 1]
\end{verbatim}

Note a few things: first, the matrix of the Hecke operator $T(7)$ does not
have integral coefficients. Indeed, recall that the basis of modular forms
in \kbd{mf} is mostly random, so there is no reason for the matrix to be
integral. On the other hand, since the eigenvalues of Hecke operators are
algebraic integers, the characteristic polynomial of $T(7)$ must be monic
with integer coefficients. As it happens, it factors completely into
linear factors to the power $1$, so all the eigenvalues of $T(7)$ are in
fact in $\Z$: this immediately shows that the splitting will be entirely
rational and the eigenforms with integer coefficients. Let's check:

\begin{verbatim}
? mf = mfsplit(mf); mffields(mf)
% = [y, y, y, y, y, y]
? L = mfeigenbasis(mf); for(i=1,6,print(mfcoefs(L[i],16)))
[0, 1, 0, 3, 0, 10, 0, 4, 0, 9, 0, -20, 0, 70, 0, 30, 0]
[0, 1, 0, 3, 0, 2, 0, 12, 0, 9, 0, 60, 0, -42, 0, 6, 0]
[0, 1, 0, 3, 0, -14, 0, -36, 0, 9, 0, -36, 0, 54, 0, -42, 0]
[0, 1, 0, -3, 0, 10, 0, -4, 0, 9, 0, 20, 0, 70, 0, -30, 0]
[0, 1, 0, -3, 0, 2, 0, -12, 0, 9, 0, -60, 0, -42, 0, -6, 0]
[0, 1, 0, -3, 0, -14, 0, 36, 0, 9, 0, 36, 0, 54, 0, 42, 0]
\end{verbatim}

We again see this \emph{twisting} phenomenon: there are three eigenforms,
plus three more which are twists.

\begin{verbatim}
? mfmatatkin(mf,3)
% =
[   0 -3    0    0  -24   0]

[-1/3  0 -4/3    0    0 -12]

[   0  0    0 -9/5 -6/5   0]

[   0  0 -2/3    0    0  -1]

[   0  0  1/6    0    0 3/2]

[   0  0    0  1/5  4/5   0]

? matdet(%)
% = -1
? mfatkineigenvalues(mf,3)
% = [[-1], [-1], [-1], [1], [1], [1]]
\end{verbatim}

This gives the matrix of the Atkin--Lehner operator $W_3$ on the given
basis of \kbd{mf}. Of course, the corresponding matrix on the \emph{eigenbasis}
will be diagonal, as the next command shows.

\medskip

\begin{verbatim}
? LE = mftolfun(mfEk(4), 1); lfun(LE, 2)/Pi^2
% = -3.3333333333333333333333333333333333333
? lfun(LE, 0)
% -1.0000000000000000000000000000000000000
? D = mfDelta(); L = mftolfun(D, 3);
? lfunlambda(L, 3)/lfunlambda(L, 5)
% = 1.5555555555555555555555555555555555556
? lfunlambda(L, 1)/lfunlambda(L, 3)
% = 2.3444283646888567293777134587554269175
? bestappr(%)
% = 1620/691
\end{verbatim}

The command \kbd{mftolfun} creates the $L$-function associated to the
modular form which can be used with the $L$-function package.
The flag $1$ in the first command indicates that the modular form $E_4$ is
real. The $L$-function associated to it is equal to $240\z(s)\z(s-3)$,
whence the value of {\tt lfun(LE,2)/Pi\^{}2}. Note that although the
$L$-function coefficients are $a(1)$, $a(2)$, etc..., so that we seem to have
lost the constant term $a(0)$, it can be recovered with the formula
$a(0)=-L(f,0)$, as the next command shows.

The flag $3$ in the command \kbd{mftolfun(D, 3)} indicates that the
modular form is both real and cuspidal. It can be omitted since this simply
incurs a small efficiency loss. The other commands illustrate Manin's
rationality theorem on periods of modular forms.

Another illustration of the $L$-function package:

\begin{verbatim}
? LIN = lfuninit(L, [6, 6, 50]);
? ploth(t = 0, 50, lfunhardy(LIN, t))
\end{verbatim}

%\includegraphics[width=\textwidth]{pari3.pdf}

\medskip

Intimately linked to Manin's rationality theorem are \emph{period polynomials}.

\begin{verbatim}
? PP = mfperiodpol(mfDelta(),-1); PP /= polcoeff(PP,1);
? bestappr(PP)
% = x^9 - 25/4*x^7 + 21/2*x^5 - 25/4*x^3 + x
? PM = mfperiodpol(mfDelta(),1); PM /= polcoeff(PM,0);
? bestappr(PP)
% = -x^10 + 691/36*x^8 - 691/12*x^6 + 691/12*x^4 - 691/36*x^2 + 1
? mfperiodpolbasis(12)
% = [x^8 - 3*x^6 + 3*x^4 - x^2,\
     4*x^9 - 25*x^7 + 42*x^5 - 25*x^3 + 4*x, x^10 - 1]
\end{verbatim}

The flags $-1$ and $1$ ask for the \emph{odd} and \emph{even} period
polynomials respectively. We divide by one of the coefficients of the
period polynomial to see the rationality. Note that the above commands
are essentially equivalent to the \kbd{lfunmfspec} function of the
\kbd{lfun} package.

The last command gives us a basis of period polynomials of weight $12$, and
we see that the odd period polynomial of \kbd{mfDelta} is indeed proportional
to the second basis vector, and the even period polynomial is a trivial
linear combination of the first and third basis vector.

\medskip

\begin{verbatim}
? E4 = mfEk(4); F = mfmulRC(E4, E4, 2); mfcoefs(F, 6)/4800
% = [0, 1, -24, 252, -1472, 4830, -6048]
? D = mfDelta(); mftaylor(D, 10)*1728
% =  [1, 0, -1/12, 0, 1/96, 0, 1/288, 0, -11/2304, 0, 7/9216]
? D3 = mftwist(D, -3); mfcoefs(D3, 10)
% = [0, 1, 24, 0, -1472, -4830, 0, -16744, -84480, 0, -115920]
? P = mfparams(D3)
% = [9, 12, 1]
? mf = mfinit(P, 1); mftobasis(mf, D3)
% = [0, 0, 0, 0, 0, 5546/4131, -1232/12393, -47/16524, 11/24786]~
\end{verbatim}

These show a few unrelated commands: \kbd{mfmulRC} gives the $m$-th
Rankin--Cohen bracket, \kbd{mftaylor} gives the Taylor expansion of
a modular form on the whole modular group at the point $i$ (for now,
no other expansions are implemented), \kbd{mftwist} gives the twist
by a quadratic character.

\kbd{mfparams} outputs the $[N,k,\chi]$ corresponding to the modular form,
where $N$ may be a multiple of the minimal level on which the form is defined
(note that in rare cases, \kbd{mfparams} may fail to find these quantities,
in which case it outputs $[0,0,0]$). The output of \kbd{mfparams} can be
fed directly to \kbd{mfinit}, as in the next line.

Finally, \kbd{mftobasis} gives the decomposition of the modular form
on the modular form space.

\medskip

\begin{verbatim}
? F = mffromell(ellinit("49a1"))[2]; mfisCM(F)
% = -7
? mfisequal(F, mftwist(F, -7))
% = 1
? mf = mfsplit([23,1,-23], 1);
? F = mfeigenbasis(mf)[1]; mfisCM(F)
% = -23
? mfisequal(F, mftwist(F, -23))
% = 0
\end{verbatim}

Here we have chosen an elliptic curve with complex multiplication by
the quadratic order of discriminant $-7$, and the \kbd{mfisCM} command
confirms this at the level of modular forms associated to the elliptic curve
by modularity. We can also check that $F$ is equal to its quadratic twist
by $(-7/n)$, which shows that $F$ is CM. However, beware, the next command
shows that this is not necessary: the theta series of discriminant $-23$
obtained by the \kbd{mfeigenbasis} command has CM by $-23$, but is \emph{not}
equal to its quadratic twist by $(-23/n)$.

\medskip

The last command that we want to illustrate is \kbd{mfsearch}: the idea
of this command is simple: you believe that you have have a modular form,
but you do not know its level, weight, character, or field of definition
of its coefficients, but only a number of its Fourier coefficients, perhaps
only modulo $p$, and you would like to find forms which ``match'' your
given form. In this degree of generality, the search space is too wide
and would take much too long. We have therefore decided to reduce
the generality, so as to make the search more reasonable. Note that this
will probably vary with the different versions of the program, so what is
described here may be more or less restrictive than future versions.

In the present implementation, we assume that the form we are looking
for is a cuspidal \emph{eigenform}, and that its field of definition is $\Q$,
so that its Fourier coefficients are integers, and its character is
(trivial or) quadratic. An example is as follows:

\begin{verbatim}
? L = mfsearch([30,4], [[2,2],[3,-1]]); #L
% = 1
? [N, F] = L[1]; mfparams(F)
% = [26, 4, 1]
? mfcoefs(F, 10)
% = [0, 1, 2, -1, 4, 17, -2, -35, 8, -26, 34]
\end{verbatim}

The first command asks for all forms as above in weight $4$ and level
up to $30$, such that $a(2)=2$ and $a(3)=-1$. The answer is that there is a
single such form, given in format $[N,F]$, where $F$ is the form
and $N$ is its level, here $N = 26$. We compute its Fourier coefficients up
to $10$ and we see that indeed $a(2)=2$ and $a(3)=-1$.

The way to specify levels and weights will certainly change, for now we
stick to the above format, a two-component vector $[N_0,k,0]$,
where we look in weight $k$ at levels up to $N_0$, with trivial
or quadratic characters.

To specify the coefficients that we want there are a number of ways. The
simplest, as above, is to give the list of pairs of integers $[p,a(p)]$.
For instance:

\begin{verbatim}
? L = mfsearch([80,2], [[2,2], [7,-3]]); #L
% = 1
? [N, F] = L[1]; mfparams(F)
% = [75, 2, 1]
? mfcoefs(F, 12)
% = [0, 1, 2, -1, 2, 0, -2, -3, 0, 1, 0, 2, -2]
\end{verbatim}

The coefficient $a(p)$ may also be given as an \kbd{intmod} \kbd{Mod}$(a,m)$
then one looks for a match for $a(p)$ modulo $m$. For instance, we come
back to our first example:
\begin{verbatim}
? L=mfsearch([30,4], [[2,Mod(2,5)], [3,Mod(-1,5)]]); #L
% = 2
? apply(x->x[1], L)
% = [26, 26]
? F1 = L[1][2]; mfcoefs(F1, 10)
% = [0, 1, 2, -1, 4, 17, -2, -35, 8, -26, 34]
? F2 = L[2][2]; mfcoefs(F2, 10)
% = [0, 1, 2, 4, 4, -18, 8, 20, 8, -11, -36]
? F = mflinear([F1, F2], [-1, 1]);
? content(mfcoefs(F, mfsturm([26,4])+1))
% = 5
\end{verbatim}

Working modulo $5$, we now find that there are \emph{two} eigenforms
satisfying our criteria, and perhaps surprisingly, both are in weight $4$
and level $26$. The first, \kbd{F1}, is the one found above, with
$a(2)=2$ and $a(3)=-1$. The second, \kbd{F2}, has $a(2)=2$ but
$a(3)=4\equiv-1\pmod5$.

But we can go further and see that this is not a simple coincidence:
the next command shows that both eigenforms seem to be congruent modulo $5$,
at least up to $a(16)$. In fact they are indeed congruent modulo $5$:
to prove this, we use the fact that the basic sturm bound (the one obtained
using \kbd{mfsturm([N,k])}, not \kbd{mfsturm(mf)}) is also valid modulo
$p$. Here the bound is equal to $15$, so the fact that the coefficients
are congruent up to $n=16$ shows that they are congruent for all $n$.

\section{Reference Manual for the MF Package}

We give a brief description in alphabetical order of all the functions
specific to the package. To use the package, it is sometimes necessary to
use functions on characters or functions of the \kbd{lfun} package, but
those will not be described here.

\smallskip

\kbd{mfatkin(mf, F, Q)}: computes $F|_k W_Q$, where $Q\Vert N$, where $F$
belongs to the split space \kbd{mf} (not checked).

\kbd{mfatkineigenvalues(mf, Q)}: \kbd{mf} being a split space with trivial
or quadratic character defined modulo $N/Q$, gives the vector of Atkin--Lehner
eigenvalues for each Galois eigenspace.

\kbd{mfbasis(mf)}: whether \kbd{mf} is split or not, gives the basis of
modular forms obtained by the initial \kbd{mfinit} (use \kbd{mfeigenbasis}
for the eigenforms).

\kbd{mfbd(F,d)}: gives $B(d)(F)$, $B(d)$ expanding operator.

\kbd{mfcoef(F,n)}: $n$th Fourier coefficient $a(n)$ of $F$.

\kbd{mfcoefs(F,n)}: vector $[a(0),a(1),...,a(n)]$ of the Fourier coefficients
of $F$ up to $n$.

\kbd{mfconductor(F)}: smallest $M$ such that $F$ belongs to
$M_k(\G_0(M),\chi)$.

\kbd{mfcreate(F)}: create a modular form from some data F.

\kbd{mfcuspexpansion(mf,F,cusp,n)}: \kbd{F} being a form in a split space
\kbd{mf}, compute the Fourier coefficients $[a(0),...,a(n)]$ at the given cusp,
given in the form $a/c$ with $c\mid N$.

\kbd{mfcuspisregular(NK,cusp)}: \kbd{NK} being $[N,k,\chi]$ or an \kbd{mf},
determine if the cusp is regular or not.

\kbd{mfcusps(N)}: list of cusps of $\G_0(N)$.

\kbd{mfcuspwidth(N,cusp)}: width of \kbd{cusp} in $\G_0(N)$.

\kbd{mfDelta()}: Ramanujan's Delta function of weight $12$.

\kbd{mfderiv(F,\{m=1\})}: $m$th derivative $q.d/dq$ of $F$. The result is
only quasi-modular.

\kbd{mfderivE2(F,\{m=1\})}: $m$th Serre derivative $q.d/dq F-kE_2F/12$.

\kbd{mfdim(mf,\{space=0\})}: dimension of the space \kbd{mf}, where \kbd{mf}
can also be of the form $[N,k,\chi]$ in which case \kbd{space} is taken into
account. \kbd{mf} can also be of the form $[N,k,0]$, where $0$ is a wildcard,
in which case it gives detailed information for each character $\chi$
for which the corresponding space of level $N$, weight $k$ and given
character is nonzero: each result is of the form
\kbd{[order,Conrey,dim,dimdih]}, where \kbd{Conrey} is the
Conrey label for the character, \kbd{order} is its order, \kbd{dim} is
the dimension of the corresponding space, and \kbd{dimdih}, which is
computed only in weight $1$, is the dimension of the subspace of dihedral
forms.

\kbd{mfdiv(F,G)}: division of \kbd{F} by \kbd{G}.

\kbd{mfeigenbasis(mf)}: \kbd{mf} being a split new space, gives (in some order)
the basis of normalized eigenforms.

\kbd{mfeisen(k,\{CHI1\},\{CHI2\})}: Eisenstein series $E_k(\chi_1)$ or
$E_k(\chi_1,\chi_2)$, normalized so that $a(1)=1$ (so \kbd{mfeisen(k)} without
any character argument is equal to \kbd{mfEk(k)} multiplied by $-B_k/(2k)$).

\kbd{mfEk(k)}: Eisenstein series $E_k$ for the full modular group normalized
so that $a(0)=1$, including for $k=2$.

\kbd{mfembed(F)}: vector of all embeddings of $F$ into $\C$.

\kbd{mfetaquo(eta)}: \kbd{eta} being a matrix representing an eta quotient,
gives the corresponding modular form, possibly with a fractional or negative
power of $q$ removed.

\kbd{mfeval(F,vtau)}: evaluation of $F$ at the point \kbd{vtau} (or a
vector of points) in the upper half-plane.

\kbd{mffields(mf)}: \kbd{mf} being a split new space, gives the list of
relative polynomials defining the number field extensions for all the Galois
orbits of the eigenforms.

\kbd{mffromell(e)}: \kbd{e} being an elliptic curve defined over $\Q$ in
\kbd{ellinit} format, gives \kbd{[mf,F,coe]}, where \kbd{F} is the eigenform
corresponding to \kbd{e} by modularity, \kbd{mf} the corresponding new space,
and \kbd{coe} the coefficients of \kbd{F} on the basis of \kbd{mf}.

\kbd{mffromqf(Q,\{P\})}: \kbd{Q} being an even integral quadratic form of even
dimension and \kbd{P} an optional homogeneous spherical polynomial with
respect to \kbd{Q}, gives \kbd{[mf,F,coe]}, where \kbd{F} is the theta
function associated to \kbd{Q} and \kbd{P}, \kbd{mf} the corresponding space,
and \kbd{coe} the coefficients of \kbd{F} on the basis of \kbd{mf}.

\kbd{mffromlfun(L)}: \kbd{L} being the $L$-function of a real eigenform,
create the corresponding modular form.

\kbd{mfgaloistype(mf,\{F\},\{lim=200\})}: \kbd{mf} being either $[N,1,\chi]$ or
a new space of weight $1$ forms, outputs the type of the projective
representations attached to all the eigenforms in \kbd{mf}, or only that of
\kbd{F} if it is given. The output is $n$ for $D_n$, or $-12$, $-24$, $-60$ for
$A_4$, $S_4$, $A_5$. \kbd{lim} controls the correctness of $n$ in the $D_n$
case.

\kbd{mfhecke(F,n,\{mf\})}: Computes $T(n)(f)$, where $T(n)$ is the $n$th Hecke
operator. If \kbd{mf} (or \kbd{[N,k,CHI]}) is specified, where $N$ is a
multiple of the level of $F$, use $T_N(n)$, the $n$th Hecke operator
in level $N$.

\kbd{mfinit(NK,\{space=0\})}: create the space of modular forms associated to
$NK=[N,k,\chi]$ or $NK=[N,k]$. Codes for \kbd{space} is $0$, new space
(default), $1$ cuspidal space, $2$ old space, $3$ full space $M_k$,
$4$ space of Eisenstein series. $NK$ can also be of the form $NK=[N,k,0]$,
where $0$ is a wildcard, in which case it gives the vector of \kbd{mfinit}
for each character $\chi$, including the ones corresponding to zero spaces.

\kbd{mfinteg(F,\{m=1\})}: $m$th formal integration of \kbd{F} with respect
to $q.d/dq$; we must have $a(0)=0$.

\kbd{mfisCM(F)}: returns $0$ if $F$ is not a CM form, otherwise the
discriminant(s) of the CM multiplication fields.

\kbd{mfiscuspidal(F)}: is $F$ a cusp form ?

\kbd{mfisequal(F,G,\{lim=0\})}: Are $F$ and $G$ equal, or at least are their
first \kbd{lim+1} Fourier coefficients equal ?

\kbd{mfisselfdual(F)}: is $F|_kW_N$ a multiple of $F$ ?

\kbd{mftolfun(F,\{flag=0\})}: $F$ being already embedded, creates the
$L$-function associated to $F$, for use in the \kbd{lfun} package.
\kbd{F} can also be a split new space, in which case the output are
all $L$-functions associated to the eigenforms. \kbd{flag} can be used to
slightly speed up the computations: $1$ if real, $2$ if a cusp form,
$3$ if both.

\kbd{mflinear(vecF,vecL)}: linear combination of the forms in \kbd{vecF}
with coefficients in \kbd{vecL}. Forms must have the same weight and
character, but not necessarily the same level.

\kbd{mfmatatkin(mf,Q,\{\&A\})}: gives the matrix of the Atkin--Lehner operator
$W_Q$ on the space \kbd{mf}. For now, there are a number of restrictions:
\kbd{mf} must be a split new space, $Q\Vert N$, and $\chi$ must be a quadratic
(or trivial) character defined modulo $N/Q$. The output is a matrix with
rational coefficients, but the true result is that matrix divided by
$\sqrt{A}$.

\kbd{mfmathecke(mf,n)}: matrix of $T(n)$ on the space \kbd{mf}.

\kbd{mfmul(F,G)}: product of the modular forms $F$ and $G$.

\kbd{mfmulRC(F,G,\{m=0\})}: $m$th Rankin--Cohen bracket of $F$ and $G$.

\kbd{mfnumcusps(N)}: number of cusps of $\G_0(N)$.

\kbd{mfparams(F)}: returns parameters $[N,k,\chi]$ of the modular form $F$.
In rare cases this may fail, in which case it returns $[0,0,0]$.

\kbd{mfperiodpol(F,\{flag=0\},\{der=0\})}: period polynomial of the eigenform
$F$, even/odd period polynomial if \kbd{flag} is $1$ or $-1$. If \kbd{der}
is $>0$, use the \kbd{der}th derivative of $\Lambda$ instead of $\Lambda$.

\kbd{mfperiodpolbasis(k,\{flag=0\})}: basis of period polynomials of weight
$k$, even/odd ones if \kbd{flag} is $1$ or $-1$.

\kbd{mfpow(F, n)}: Modular form $F$ to the power $n$.

\kbd{mfsearch(NK,AP)}: search for normalized eigenforms with
integer coefficients in spaces specified by \kbd{NK}, satisfying conditions
satisfied by \kbd{AP}. \kbd{NK} is a pair $[N_0,k]$, the search being in
weight $k$ up to level $N_0$ with trivial or quadratic character.
\kbd{AP} is a list of pairs $[[p_1,a(p_1)],...,[p_n,a(p_n)]]$, where $a(p)$
is either an integer or an \kbd{intmod} (match modulo $a(p)\kbd{.mod}$).

\kbd{mfshift(F,m)}: \kbd{F} divided by $q^m$, omitting the remainder if there
is one, where $m$ can be positive or negative.

\kbd{mfspace(mf)}: type of modular space \kbd{mf}, or of a modular form;
$0$ for new, $1$ for cuspidal, $2$ for old, $3$ for full, $4$ for Eisenstein.

\kbd{mfsplit(mf,\{dimlim=0\},\{flag=0\})}: compute the eigenforms in \kbd{mf},
and limit the dimension of each Galois orbit to \kbd{dimlim} if set.
\kbd{flag} is used to avoid some long computations (see doc). Note that
\kbd{mf} can also be \kbd{[N,k,CHI]}, in which case this is equivalent to
\kbd{mfsplit(mfinit([N,k,CHI]))}.

\kbd{mfsturm(mf)}: If \kbd{mf} is a space, true Sturm bound of \kbd{mf}, i.e.,
largest valuation at infinity of a nonzero form. If \kbd{mf} is $[N,k,\chi]$,
only an upper bound.

\kbd{mftaylor(F,n,\{fl=0\})}: for now, only for $F\in M_k(\G)$ and at the
point $i$. Compute the first $n$ Taylor coefficients of $F$ around $i$;
if \kbd{fl} is set compute in fact $p_n$ such that
$$f(\tau)=(2i/(\tau+i))^k\sum_{n>=0}p_n((\tau-i)/(\tau+i))^n\;.$$

\kbd{mftobasis(mf,F,\{flag=0\})}: coefficients of form $F$ on the basis in
\kbd{mf}. If \kbd{flag} is set, do not return an error if $F$ does not
belong to \kbd{mf} or not enough coefficients.

\kbd{mftonew(mf,F)}: Decompose $F$ is the cuspidal space \kbd{mf} as
a sum of $B(d)G_M$ where $G_M\in S_k^{\new}(\G_0(M),\chi)$ and $dM\mid N$,
return the vector of $[M,d,G]$.

\kbd{mftraceform(NK,\{space=0\})}: gives the trace form corresponding to
$NK=[N,k,\chi]$ and \kbd{space}.

\kbd{mftwist(F,D)}: twist of the form $F$ by the quadratic character
$(D/n)$.

\kbd{mfval(F)}: valuation at infinity of $F$.

\end{document}
